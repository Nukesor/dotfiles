# vim: filetype=zsh
# Select a git branch
git_branch_list() {
    local branches=$(git branch --format='%(refname:short)')
    local selection=( $($(__fzfcmd) -m \
        --preview 'git diff --color=always {}' \
        --preview-window up:60%  \
        --bind=ctrl-n:preview-down,ctrl-p:preview-up,q:abort,tab:toggle,ctrl-i:toggle,ctrl-o:toggle-preview <<< $branches) )

    if [[ ! -z "$BUFFER" ]]; then
        BUFFER+="${selection}"
        CURSOR+=${#selection}
        CURSOR+=1
        zle redisplay
        return 0
    fi

    git switch $selection
    local ret=$?

    # Without this, no prompt will be visible.
    zle reset-prompt
    return $ret
}
